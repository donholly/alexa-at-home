console.log(__dirname);
console.log(__filename);
var Yamaha = require("./yahama.js");
var yamahaAPI = new Yamaha("192.168.0.30");

yamahaAPI.isOn().done(function(result){
	console.log("RECEIVER STATUS: " + result);
});

this.requestHandler = function (req, res) {
	var params = req.url.substring(1).split('/');

	var player = discovery.getPlayer(decodeURIComponent(params[0]));

	var opt = {};

	if (player) {
		opt.action = (params[1]||'').toLowerCase();
		opt.values = params.splice(2);
	} else {
		player = discovery.getAnyPlayer();
		opt.action = (params[0]||'').toLowerCase();
		opt.values = params.splice(1);
	}

	opt.player = player;
	handleAction(opt, function actionCallback(response) {
		if (response) {
			var jsonResponse = JSON.stringify(response);
			res.setHeader('Content-Length', Buffer.byteLength(jsonResponse));
			res.setHeader('Content-Type', 'application/json;charset=utf8');
			res.write(new Buffer(jsonResponse));
		}
		res.end();
	});
};
